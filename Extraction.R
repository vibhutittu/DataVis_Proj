library(blscrapeR)
library(rjson)
library(blsAPI)
library(ggplot2)

#States and its codes
index <- c('LAUST010000000000003','LAUST020000000000003','LAUST040000000000003','LAUST050000000000003','LAUST060000000000003','LAUST080000000000003','LAUST090000000000003','LAUST100000000000003','LAUST110000000000003','LAUST120000000000003','LAUST130000000000003','LAUST150000000000003','LAUST160000000000003','LAUST170000000000003','LAUST180000000000003','LAUST190000000000003','LAUST200000000000003','LAUST210000000000003','LAUST220000000000003','LAUST230000000000003','LAUST240000000000003','LAUST250000000000003','LAUST260000000000003','LAUST270000000000003','LAUST280000000000003','LAUST290000000000003','LAUST300000000000003','LAUST310000000000003','LAUST320000000000003','LAUST330000000000003','LAUST340000000000003','LAUST350000000000003','LAUST360000000000003','LAUST370000000000003','LAUST380000000000003','LAUST390000000000003','LAUST400000000000003','LAUST410000000000003','LAUST420000000000003','LAUST440000000000003','LAUST450000000000003','LAUST460000000000003','LAUST470000000000003','LAUST480000000000003','LAUST490000000000003','LAUST500000000000003','LAUST510000000000003','LAUST530000000000003','LAUST540000000000003','LAUST550000000000003')
states<- c('Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','District of Columbia','Florida','Georgia','Hawaii','Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky','Louisiana','Maine','Maryland','Massachusetts','Michigan','Minnesota','Mississippi','Missouri','Montana','Nebraska','Nevada',' New Hampshire','New Jersey','New Mexico','New York','North Carolina','North Dakota','Ohio','Oklahoma',
           'Oregon','Pennsylvania','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Vermont',
           'Virginia','Washington','West Virginia','Wisconsin')

index1<- c('LAUST560000000000003','LAUST720000000000003')
states_rem<- c('Wyoming','Puerto Rico')

#Extraction of data from api
df <- bls_api(c('LAUST010000000000003','LAUST020000000000003','LAUST040000000000003','LAUST050000000000003','LAUST060000000000003','LAUST080000000000003','LAUST090000000000003','LAUST100000000000003','LAUST110000000000003','LAUST120000000000003','LAUST130000000000003','LAUST150000000000003','LAUST160000000000003','LAUST170000000000003','LAUST180000000000003','LAUST190000000000003','LAUST200000000000003','LAUST210000000000003','LAUST220000000000003','LAUST230000000000003','LAUST240000000000003','LAUST250000000000003','LAUST260000000000003','LAUST270000000000003','LAUST280000000000003','LAUST290000000000003','LAUST300000000000003','LAUST310000000000003','LAUST320000000000003','LAUST330000000000003','LAUST340000000000003','LAUST350000000000003','LAUST360000000000003','LAUST370000000000003','LAUST380000000000003','LAUST390000000000003','LAUST400000000000003','LAUST410000000000003','LAUST420000000000003','LAUST440000000000003','LAUST450000000000003','LAUST460000000000003','LAUST470000000000003','LAUST480000000000003','LAUST490000000000003','LAUST500000000000003','LAUST510000000000003','LAUST530000000000003','LAUST540000000000003','LAUST550000000000003','LAUST560000000000003','LAUST720000000000003'),
              startyear = 2006, endyear = 2015,
              registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df2 <- bls_api(c('LAUST010000000000003','LAUST020000000000003','LAUST040000000000003','LAUST050000000000003','LAUST060000000000003','LAUST080000000000003','LAUST090000000000003','LAUST100000000000003','LAUST110000000000003','LAUST120000000000003','LAUST130000000000003','LAUST150000000000003','LAUST160000000000003','LAUST170000000000003','LAUST180000000000003','LAUST190000000000003','LAUST200000000000003','LAUST210000000000003','LAUST220000000000003','LAUST230000000000003','LAUST240000000000003','LAUST250000000000003','LAUST260000000000003','LAUST270000000000003','LAUST280000000000003','LAUST290000000000003','LAUST300000000000003','LAUST310000000000003','LAUST320000000000003','LAUST330000000000003','LAUST340000000000003','LAUST350000000000003','LAUST360000000000003','LAUST370000000000003','LAUST380000000000003','LAUST390000000000003','LAUST400000000000003','LAUST410000000000003','LAUST420000000000003','LAUST440000000000003','LAUST450000000000003','LAUST460000000000003','LAUST470000000000003','LAUST480000000000003','LAUST490000000000003','LAUST500000000000003','LAUST510000000000003','LAUST530000000000003','LAUST540000000000003','LAUST550000000000003','LAUST560000000000003','LAUST720000000000003'),
              startyear = 1996, endyear = 2005,
              registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df3 <- bls_api(c('LAUST010000000000003','LAUST020000000000003','LAUST040000000000003','LAUST050000000000003','LAUST060000000000003','LAUST080000000000003','LAUST090000000000003','LAUST100000000000003','LAUST110000000000003','LAUST120000000000003','LAUST130000000000003','LAUST150000000000003','LAUST160000000000003','LAUST170000000000003','LAUST180000000000003','LAUST190000000000003','LAUST200000000000003','LAUST210000000000003','LAUST220000000000003','LAUST230000000000003','LAUST240000000000003','LAUST250000000000003','LAUST260000000000003','LAUST270000000000003','LAUST280000000000003','LAUST290000000000003','LAUST300000000000003','LAUST310000000000003','LAUST320000000000003','LAUST330000000000003','LAUST340000000000003','LAUST350000000000003','LAUST360000000000003','LAUST370000000000003','LAUST380000000000003','LAUST390000000000003','LAUST400000000000003','LAUST410000000000003','LAUST420000000000003','LAUST440000000000003','LAUST450000000000003','LAUST460000000000003','LAUST470000000000003','LAUST480000000000003','LAUST490000000000003','LAUST500000000000003','LAUST510000000000003','LAUST530000000000003','LAUST540000000000003','LAUST550000000000003','LAUST560000000000003','LAUST720000000000003'),
               startyear = 1986, endyear = 1995,
               registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df4 <- bls_api(c('LAUST010000000000003','LAUST020000000000003','LAUST040000000000003','LAUST050000000000003','LAUST060000000000003','LAUST080000000000003','LAUST090000000000003','LAUST100000000000003','LAUST110000000000003','LAUST120000000000003','LAUST130000000000003','LAUST150000000000003','LAUST160000000000003','LAUST170000000000003','LAUST180000000000003','LAUST190000000000003','LAUST200000000000003','LAUST210000000000003','LAUST220000000000003','LAUST230000000000003','LAUST240000000000003','LAUST250000000000003','LAUST260000000000003','LAUST270000000000003','LAUST280000000000003','LAUST290000000000003','LAUST300000000000003','LAUST310000000000003','LAUST320000000000003','LAUST330000000000003','LAUST340000000000003','LAUST350000000000003','LAUST360000000000003','LAUST370000000000003','LAUST380000000000003','LAUST390000000000003','LAUST400000000000003','LAUST410000000000003','LAUST420000000000003','LAUST440000000000003','LAUST450000000000003','LAUST460000000000003','LAUST470000000000003','LAUST480000000000003','LAUST490000000000003','LAUST500000000000003','LAUST510000000000003','LAUST530000000000003','LAUST540000000000003','LAUST550000000000003','LAUST560000000000003','LAUST720000000000003'),
               startyear = 1976, endyear = 1985,
               registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df5 <- bls_api(c('LAUST560000000000003','LAUST720000000000003'),
               startyear = 2006, endyear = 2015,
               registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df6 <- bls_api(c('LAUST560000000000003','LAUST720000000000003'),
               startyear = 1996, endyear = 2005,
               registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df7 <- bls_api(c('LAUST560000000000003','LAUST720000000000003'),
               startyear = 1986, endyear = 1995,
               registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df8 <- bls_api(c('LAUST560000000000003','LAUST720000000000003'),
               startyear = 1976, endyear = 1985,
               registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df9<- bls_api(c('LAUST010000000000003','LAUST020000000000003','LAUST040000000000003','LAUST050000000000003','LAUST060000000000003','LAUST080000000000003','LAUST090000000000003','LAUST100000000000003','LAUST110000000000003','LAUST120000000000003','LAUST130000000000003','LAUST150000000000003','LAUST160000000000003','LAUST170000000000003','LAUST180000000000003','LAUST190000000000003','LAUST200000000000003','LAUST210000000000003','LAUST220000000000003','LAUST230000000000003','LAUST240000000000003','LAUST250000000000003','LAUST260000000000003','LAUST270000000000003','LAUST280000000000003','LAUST290000000000003','LAUST300000000000003','LAUST310000000000003','LAUST320000000000003','LAUST330000000000003','LAUST340000000000003','LAUST350000000000003','LAUST360000000000003','LAUST370000000000003','LAUST380000000000003','LAUST390000000000003','LAUST400000000000003','LAUST410000000000003','LAUST420000000000003','LAUST440000000000003','LAUST450000000000003','LAUST460000000000003','LAUST470000000000003','LAUST480000000000003','LAUST490000000000003','LAUST500000000000003','LAUST510000000000003','LAUST530000000000003','LAUST540000000000003','LAUST550000000000003','LAUST560000000000003','LAUST720000000000003'),
             startyear = 2016, endyear = 2016,
             registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")

df10<- bls_api(c('LAUST560000000000003','LAUST720000000000003'),
               startyear = 2016, endyear = 2016,
               registrationKey = "f7b6afc5021a47b2bc93ee4fa5ef0105")



#Sort them with id

df1<- df[order(df$seriesID),]
df2<- df2[order(df2$seriesID),]
df3<- df3[order(df3$seriesID),]
df4<- df4[order(df4$seriesID),]

df5<- df5[order(df5$seriesID),]
df6<- df6[order(df6$seriesID),]
df7<- df7[order(df7$seriesID),]
df8<- df8[order(df8$seriesID),]
df9<- df9[order(df9$seriesID),]
df10<-df10[order(df10$seriesID),]

#Add state names and save it
df1$states<- states[match(df1$seriesID,index)]
write.csv(df1,file="2006_2015.csv")

df2$states<- states[match(df2$seriesID,index)]
write.csv(df2,file="1996_2005.csv")

df3$states<- states[match(df3$seriesID,index)]
write.csv(df3,file="1986_1995.csv")

df4$states<- states[match(df4$seriesID,index)]
write.csv(df4,file="1976_1985.csv")

df5$states<- states_rem[match(df5$seriesID,index1)]
write.csv(df5,file="2006_2015_rem.csv")

df6$states<- states_rem[match(df6$seriesID,index1)]
write.csv(df6,file="1996_2005_rem.csv")

df7$states<- states_rem[match(df7$seriesID,index1)]
write.csv(df7,file="1986_1995_rem.csv")

df8$states<- states_rem[match(df8$seriesID,index1)]
write.csv(df8,file="1976_1985_rem.csv")

df9$states<- states[match(df9$seriesID,index)]
write.csv(df9,file="2016_2016.csv")

df10$states<- states_rem[match(df10$seriesID,index1)]
write.csv(df10,file="2016_2016_rem.csv")

#combine all data

combined<- rbind(df5,df6,df7,df8,df10)
final_data<- rbind(df1,df2,df3,df4,df9,combined)

final_data<- final_data[order(final_data$seriesID),]
final_data<- final_data[order(final_data$year,final_data$periodName),]

final_data<- final_data[,-(5:7)]
final_data<- final_data[,-(2)]

names(final_data)[3]<- "unemployment_rate"

write.csv(final_data,file="final_data.csv")


